<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rayo Vilkins ‚Äì Trends & Season Overview</title>
<style>
  :root{
    --bg:#0f0f0f; --card:#1a1a1a; --text:#ffffff; --muted:#a1a1aa; --line:#333333;
    --active-bg:#1e40af; --active-br:#3b82f6; --active-tx:#ffffff;
    --win:#22c55e; --loss:#ef4444; --draw:#f59e0b;
    --match-bg:#1f1f1f;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  body::after{content:"";display:block;height:100px}

  /* Header */
  header{position:sticky;top:0;z-index:10;background:var(--card);border-bottom:1px solid var(--line)}
  .bar{max-width:1500px;margin:0 auto;display:flex;gap:12px;align-items:center;padding:10px 14px}
  .brand{font-weight:800;letter-spacing:.2px;font-size:14px;opacity:.9}
  .brand a{color:inherit;text-decoration:none}
  nav{display:flex;gap:6px}
  nav a{color:var(--muted);text-decoration:none;font-size:13px;padding:6px 10px;border-radius:8px;border:1px solid transparent}
  nav a[aria-current="page"]{background:var(--active-bg);border-color:var(--active-br);color:var(--active-tx)}
  nav a:hover{color:var(--text)}
  .spacer{flex:1}

  /* Page */
  .wrap{max-width:1400px;margin:16px auto;padding:0 12px}
  .page-header{text-align:center;margin-bottom:20px}
  .page-title{font-size:28px;font-weight:800;margin-bottom:6px}
  .page-subtitle{color:var(--muted);font-size:14px}

  .section-card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;margin-bottom:16px}
  .section-title{font-size:18px;font-weight:700;margin-bottom:6px;display:flex;gap:8px;align-items:center}
  .section-subtitle{font-size:12px;color:var(--muted);margin-bottom:10px}

  /* Controls */
  .chart-controls{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:12px;padding:12px;background:var(--match-bg);border-radius:8px;border:1px solid var(--line)}
  .control-group{display:flex;flex-direction:column;gap:6px}
  .control-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;font-weight:600}
  .checkbox-group{display:flex;flex-wrap:wrap;gap:8px}
  .checkbox-item{display:flex;align-items:center;gap:6px;padding:6px 10px;background:var(--bg);border:1px solid var(--line);border-radius:6px;cursor:pointer;transition:all .2s;user-select:none}
  .checkbox-item:hover{border-color:var(--active-br)}
  .checkbox-item.active{background:var(--active-bg);color:var(--active-tx);border-color:var(--active-br)}
  .stat-color{width:12px;height:12px;border-radius:2px;margin-right:4px}
  .match-count-input{background:var(--bg);color:var(--text);border:1px solid var(--line);border-radius:6px;padding:6px 10px;width:80px}

  /* Chart */
  .chart-container{position:relative;height:380px;background:var(--match-bg);border-radius:8px;padding:12px}
  .chart-canvas{width:100% !important;height:100% !important}

  /* Form + key stats */
  .form-strip{display:flex;justify-content:center;gap:4px;margin-bottom:12px}
  .form-match{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;border:2px solid var(--line)}
  .form-match.win{background:var(--win);color:#fff;border-color:var(--win)}
  .form-match.loss{background:var(--loss);color:#fff;border-color:var(--loss)}
  .form-match.draw{background:var(--draw);color:#111827;border-color:var(--draw)}
  .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
  .stat-item{background:var(--match-bg);padding:12px;border-radius:8px;border:1px solid var(--line);text-align:center}
  .stat-value{font-size:22px;font-weight:800;margin-bottom:2px}
  .stat-value.positive{color:var(--win)} .stat-value.negative{color:var(--loss)} .stat-value.neutral{color:var(--draw)}
  .stat-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
  .stat-trend{font-size:11px;color:var(--muted);margin-top:2px}

  /* Overall ‚Äì simplified */
  .kpi{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
  .kpi .item{background:var(--match-bg);border:1px solid var(--line);border-radius:10px;padding:10px;text-align:center}
  .kpi .val{font-size:20px;font-weight:800}
  .kpi .lab{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.3px}

  .flex{display:flex;gap:12px;flex-wrap:wrap}
  .tile{flex:1 1 260px;background:var(--match-bg);border:1px solid var(--line);border-radius:10px;padding:12px}
  .tile h4{margin:0 0 6px 0;font-size:14px}
  .row{display:flex;justify-content:space-between;gap:8px}
  .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#111;display:inline-block}

  .stack-bar{height:16px;border-radius:8px;overflow:hidden;border:1px solid var(--line);display:flex}
  .stack-win{background:var(--win)} .stack-draw{background:var(--draw)} .stack-loss{background:var(--loss)}

  .list{display:flex;flex-direction:column;gap:8px}
  .simple-row{display:flex;justify-content:space-between;gap:8px;padding:8px;border:1px solid var(--line);border-radius:8px;background:#151515}
  .small{font-size:11px;color:var(--muted)}

  .loading{color:var(--muted);font-style:italic}

  @media(max-width: 980px){
    .kpi{grid-template-columns:repeat(3,1fr)}
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand"><a href="matches.html">Rayo Vilkins FC</a></div>
      <div class="spacer"></div>
      <nav>
        <a href="matches.html">Matches</a>
        <a href="stats.html">Stats</a>
        <a href="trends.html" aria-current="page">Trends</a>
        <a href="wheel.html">Wheel</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <div class="page-header">
      <h1 class="page-title">Performance Trends & Season Overview</h1>
      <p class="page-subtitle">Match-by-match trends up top ‚Ä¢ simple season story below</p>
    </div>

    <!-- ===== MATCH TRENDS ===== -->
    <div class="section-card">
      <h2 class="section-title">üìà Performance Efficiency Trends</h2>
      <p class="section-subtitle">See how your % stats moved over time</p>

      <div class="chart-controls">
        <div class="control-group">
          <label class="control-label">Show Lines</label>
          <div class="checkbox-group" id="metricControls">
            <div class="checkbox-item active" data-metric="passSuccess">
              <div class="stat-color" style="background:#8b5cf6"></div> Pass %
            </div>
            <div class="checkbox-item active" data-metric="tackleSuccess">
              <div class="stat-color" style="background:#06b6d4"></div> Tackle %
            </div>
            <div class="checkbox-item active" data-metric="shotSuccess">
              <div class="stat-color" style="background:#f97316"></div> Shot %
            </div>
          </div>
        </div>
        <div class="control-group">
          <label class="control-label">How many matches?</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input type="number" id="matchCountInput" class="match-count-input" value="20" min="5" max="999">
            <button id="showAllMatches" style="background:var(--bg);color:var(--text);border:1px solid var(--line);border-radius:6px;padding:6px 10px;cursor:pointer;font-size:12px">Show All</button>
          </div>
        </div>
      </div>

      <div class="chart-container"><canvas id="trendsChart" class="chart-canvas"></canvas></div>
    </div>

    <div class="section-card">
      <h2 class="section-title">üî• Current Form & Key Metrics</h2>
      <p class="section-subtitle">Last matches at a glance + simple season numbers</p>
      <div id="formStrip" class="form-strip"><div class="loading">Loading recent form...</div></div>
      <div id="keyStats" class="stats-grid"><div class="loading">Loading statistics...</div></div>
    </div>

    <!-- ===== SEASON OVERVIEW (SIMPLIFIED) ===== -->
    <div class="section-card">
      <h2 class="section-title">üèÅ Season Overview (Simple)</h2>
      <p class="section-subtitle">No jargon. Just the big picture.</p>

      <!-- Scoreboard -->
      <div class="kpi" id="kpi"></div>

      <div class="flex" style="margin-top:12px">
        <!-- Results mix -->
        <div class="tile">
          <h4>Results mix</h4>
          <div class="stack-bar" id="resultsBar" title="Share of wins, draws, losses"></div>
          <div class="small" id="resultsText" style="margin-top:6px"></div>
        </div>

        <!-- Key outcomes (easy wins) -->
        <div class="tile">
          <h4>Key outcomes</h4>
          <div class="list" id="keyOutcomes">
            <div class="loading">Loading‚Ä¶</div>
          </div>
          <div class="small" style="margin-top:6px">Clean sheets = no goals conceded. ‚Äú2+ goals‚Äù = strong attacking games. ‚Äú1-goal win‚Äù = clutch edge in tight matches.</div>
        </div>

        <!-- Consistency (plain English) -->
        <div class="tile">
          <h4>How steady were we?</h4>
          <div class="list" id="consistencySimple">
            <div class="loading">Loading‚Ä¶</div>
          </div>
          <div class="small" style="margin-top:6px">‚ÄúVery steady‚Äù means numbers barely swing week-to-week. ‚ÄúUp & down‚Äù means big swings.</div>
        </div>
      </div>

      <div class="flex" style="margin-top:12px">
        <!-- With/Without -->
        <div class="tile" style="flex:1 1 420px">
          <h4>Players who lift the team</h4>
          <div class="list" id="withWithout">
            <div class="loading">Loading‚Ä¶</div>
          </div>
          <div class="small" style="margin-top:6px">Impact = team performance difference in games **with** the player vs **without**.</div>
        </div>

        <!-- Chemistry pairs -->
        <div class="tile" style="flex:1 1 320px">
          <h4>Best partnerships</h4>
          <div class="list" id="pairs">
            <div class="loading">Loading‚Ä¶</div>
          </div>
          <div class="small" style="margin-top:6px">Goal contributions per game when both play.</div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const API_BASE = '';

  let allMatchesData = [];
  let displayedMatchesData = [];
  let trendsChart = null;

  const COLORS = { passSuccess:'#8b5cf6', tackleSuccess:'#06b6d4', shotSuccess:'#f97316' };
  const RESULT_COLORS = { 'W':'#22c55e', 'D':'#fbbf24', 'L':'#ef4444' };

  async function getJSON(path){
    const res = await fetch(`${API_BASE}${path}`);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  }

  /* ===== Match trends helpers ===== */
  function processMatchData(matches) {
    return matches.map((match, index) => {
      const passSuccess = match.our_passes_made && match.our_pass_attempts ?
        (parseInt(match.our_passes_made) / parseInt(match.our_pass_attempts)) * 100 : 0;
      const tackleSuccess = match.our_tackles_made && match.our_tackle_attempts ?
        (parseInt(match.our_tackles_made) / parseInt(match.our_tackle_attempts)) * 100 : 0;
      const shotSuccess = match.our_goals && match.our_shots ?
        (parseInt(match.our_goals) / parseInt(match.our_shots)) * 100 : 0;

      const goalsScored = parseInt(match.our_goals) || 0;
      const goalsConceded = parseInt(match.opponent_goals) || 0;

      return {
        matchNumber: index + 1,
        opponent: match.opponent_club_name,
        date: match.match_date,
        result: match.result,
        passSuccess, tackleSuccess, shotSuccess,
        goalsScored, goalsConceded,
        ourGoals: goalsScored, oppGoals: goalsConceded,
        isValid: !(passSuccess === 100 && (goalsScored + goalsConceded) <= 3)
      };
    }).filter(m => m.isValid);
  }

  function getActiveMetrics(){
    return Array.from(document.querySelectorAll('#metricControls .checkbox-item.active'))
      .map(el => el.getAttribute('data-metric'));
  }

  function computeYAxisRange(data, activeMetrics){
    const values = [];
    activeMetrics.forEach(metric => {
      data.forEach(d => { const v = d[metric]; if (typeof v === 'number' && isFinite(v)) values.push(v); });
    });
    if (!values.length) return {min:0, max:100};
    let min = Math.min(...values), max = Math.max(...values);
    let span = Math.max(max - min, 3);
    const pad = Math.max(2, span * 0.25);
    min = Math.max(0, Math.floor(min - pad));
    max = Math.min(100, Math.ceil(max + pad));
    if (max - min < 10){ const extra = (10 - (max - min))/2; min = Math.max(0, min - extra); max = Math.min(100, max + extra); }
    return {min, max};
  }

  function createTrendsChart(data) {
    const ctx = document.getElementById('trendsChart').getContext('2d');
    const active = getActiveMetrics();
    const datasets = active.map(metric => {
      const pts = data.map(d => RESULT_COLORS[d.result]);
      const labelMap = {passSuccess:'Pass %',tackleSuccess:'Tackle %',shotSuccess:'Shot %'};
      return {
        label: labelMap[metric],
        data: data.map(d => d[metric]),
        borderColor: COLORS[metric],
        backgroundColor: COLORS[metric] + '24',
        borderWidth: 3, fill:false, tension:0.35,
        pointBackgroundColor: pts, pointBorderColor: pts, pointBorderWidth:2, pointRadius:5, pointHoverRadius:8
      };
    });
    if (trendsChart) trendsChart.destroy();
    const yRange = computeYAxisRange(data, active);
    trendsChart = new Chart(ctx, {
      type:'line',
      data:{ labels: data.map(d => `Match ${d.matchNumber}`), datasets },
      options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{
          legend:{ position:'top', labels:{
            color:'#fff', usePointStyle:true, padding:18,
            generateLabels(chart){
              const base = Chart.defaults.plugins.legend.labels.generateLabels.call(this, chart);
              base.push(
                { text:'Win',  fillStyle:'#22c55e', strokeStyle:'#22c55e', pointStyle:'circle' },
                { text:'Draw', fillStyle:'#f59e0b', strokeStyle:'#f59e0b', pointStyle:'circle' },
                { text:'Loss', fillStyle:'#ef4444', strokeStyle:'#ef4444', pointStyle:'circle' },
              );
              return base;
            }
          }},
          tooltip:{
            mode:'index', intersect:false, backgroundColor:'#1a1a1a', titleColor:'#fff', bodyColor:'#a1a1aa',
            borderColor:'#333', borderWidth:1,
            callbacks:{
              title(ctx){ const m = data[ctx[0].dataIndex]; return `vs ${m.opponent} (${m.date})`; },
              afterTitle(ctx){ const m = data[ctx[0].dataIndex]; return `Result: ${m.ourGoals}-${m.oppGoals} (${m.result})`; }
            }
          }
        },
        scales:{
          x:{ grid:{color:'#333'}, ticks:{color:'#a1a1aa'} },
          y:{ grid:{color:'#333'}, ticks:{color:'#a1a1aa', callback:v=>v.toFixed(0)+'%'},
              min:yRange.min, max:yRange.max, beginAtZero:false }
        },
        interaction:{ mode:'nearest', axis:'x', intersect:false }
      }
    });
  }

  function renderFormStrip(data) {
    const recent = data.slice(-10);
    const container = document.getElementById('formStrip');
    container.innerHTML = recent.map(match =>
      `<div class="form-match ${match.result.toLowerCase()}" title="vs ${match.opponent}: ${match.ourGoals}-${match.oppGoals}">
        ${match.result}
      </div>`).join('');
  }

  function renderKeyStats(data) {
    const el = document.getElementById('keyStats');
    if (!data.length){ el.innerHTML = '<div class="loading">No match data available</div>'; return; }
    const avg = k => (data.reduce((s,m)=>s+(m[k]||0),0)/data.length)||0;
    const winRate = (data.filter(m=>m.result==='W').length/data.length)*100;
    const avgGoalsFor = data.reduce((s,m)=>s+(m.goalsScored||0),0)/data.length;
    const avgGoalsAgainst = data.reduce((s,m)=>s+(m.goalsConceded||0),0)/data.length;
    const recent5 = data.slice(-5);
    const rWin = recent5.length ? (recent5.filter(m=>m.result==='W').length/recent5.length)*100 : 0;
    const formTrend = rWin>winRate ? 'positive' : (rWin<winRate ? 'negative' : 'neutral');
    const streak = (()=>{ if(!data.length) return {count:0,type:'neutral',text:'No matches'};
      const last=data[data.length-1].result; let c=1; for(let i=data.length-2;i>=0;i--){ if(data[i].result===last) c++; else break; }
      const type= last==='W'?'positive':(last==='L'?'negative':'neutral');
      const text= last==='W'?'Win streak':(last==='L'?'Loss streak':'Draw streak'); return {count:c,type,text};
    })();
    el.innerHTML = `
      <div class="stat-item"><div class="stat-value">${avg('passSuccess').toFixed(1)}%</div><div class="stat-label">Pass %</div></div>
      <div class="stat-item"><div class="stat-value">${avg('tackleSuccess').toFixed(1)}%</div><div class="stat-label">Tackle %</div></div>
      <div class="stat-item"><div class="stat-value">${avg('shotSuccess').toFixed(1)}%</div><div class="stat-label">Shot %</div></div>
      <div class="stat-item"><div class="stat-value">${avgGoalsFor.toFixed(1)}</div><div class="stat-label">Goals For (per game)</div></div>
      <div class="stat-item"><div class="stat-value">${avgGoalsAgainst.toFixed(1)}</div><div class="stat-label">Goals Against (per game)</div></div>
      <div class="stat-item"><div class="stat-value">${winRate.toFixed(1)}%</div><div class="stat-label">Win Rate</div><div class="stat-trend">Overall</div></div>
      <div class="stat-item"><div class="stat-value ${formTrend}">${rWin.toFixed(1)}%</div><div class="stat-label">Recent Wins</div><div class="stat-trend">Last ${recent5.length} games</div></div>
      <div class="stat-item"><div class="stat-value ${streak.type}">${streak.count}</div><div class="stat-label">Current Streak</div><div class="stat-trend">${streak.text}</div></div>
    `;
  }

  function updateDisplayedMatches() {
    const matchCount = parseInt(document.getElementById('matchCountInput').value);
    const total = allMatchesData.length;
    displayedMatchesData = matchCount >= total ? [...allMatchesData] : allMatchesData.slice(-matchCount);
    if (displayedMatchesData.length){
      createTrendsChart(displayedMatchesData);
      renderFormStrip(displayedMatchesData);
      renderKeyStats(displayedMatchesData);
    }
  }

  /* ===== Season overview (simple) ===== */
  const pct = v => (v ?? 0).toFixed(1) + '%';
  const p2  = v => (v ?? 0).toFixed(2);
  const p1  = v => (v ?? 0).toFixed(1);
  const pos = v => (v>=0 ? '+'+p1(v) : p1(v));

  function consistencyLabel(cv){
    // cv is a % value
    if (cv <= 10) return 'Very steady ‚úÖ';
    if (cv <= 20) return 'Fairly steady üëç';
    return 'Up & down ‚ö†Ô∏è';
  }

  function renderSeasonSimple(data){
    const k = data.season_totals || {};
    // Scoreboard
    document.getElementById('kpi').innerHTML = `
      <div class="item"><div class="val">${k.games??0}</div><div class="lab">Games</div></div>
      <div class="item"><div class="val">${(k.wins??0)}-${(k.draws??0)}-${(k.losses??0)}</div><div class="lab">Record</div></div>
      <div class="item"><div class="val">${k.goal_diff??0}</div><div class="lab">Goal Diff</div></div>
      <div class="item"><div class="val">${p2(k.ppg??0)}</div><div class="lab">Points / Game</div></div>
      <div class="item"><div class="val">${k.goals_for??0}</div><div class="lab">Goals For</div></div>
      <div class="item"><div class="val">${k.goals_against??0}</div><div class="lab">Goals Against</div></div>
    `;

    // Results mix bar
    const total = (k.games||0) || 1;
    const wins  = k.wins||0;
    const draws = k.draws||0;
    const losses= k.losses||0;
    const wPct = (wins/total)*100, dPct=(draws/total)*100, lPct=(losses/total)*100;
    document.getElementById('resultsBar').innerHTML = `
      <div class="stack-win"  style="width:${wPct}%" title="Wins ${wPct.toFixed(0)}%"></div>
      <div class="stack-draw" style="width:${dPct}%" title="Draws ${dPct.toFixed(0)}%"></div>
      <div class="stack-loss" style="width:${lPct}%" title="Losses ${lPct.toFixed(0)}%"></div>
    `;
    document.getElementById('resultsText').textContent = `Wins ${wPct.toFixed(0)}% ‚Ä¢ Draws ${dPct.toFixed(0)}% ‚Ä¢ Losses ${lPct.toFixed(0)}%`;

    // Key outcomes (clean sheets, 2+ goals, one-goal edge)
    const op = data.outcome_profile || {};
    document.getElementById('keyOutcomes').innerHTML = `
      <div class="simple-row"><span>üß± Clean sheets</span><strong>${pct(op.clean_sheet_rate||0)}</strong></div>
      <div class="simple-row"><span>‚ö° Games scoring 2+ goals</span><strong>${pct(op.two_plus_goals_rate||0)}</strong></div>
      <div class="simple-row"><span>üß© Wins in 1-goal games</span><strong>${pct(op.one_goal_edge||0)}</strong></div>
    `;

    // Consistency ‚Äì plain English + lineup stability + change alerts
    const cs = data.consistency || {};
    const rows = [
      ['Passing consistency', consistencyLabel(cs.cv_pass_pct||0)],
      ['Finishing consistency', consistencyLabel(cs.cv_shot_pct||0)],
      ['Tackling consistency', consistencyLabel(cs.cv_tackle_pct||0)],
      ['Attack output (goals for)', consistencyLabel(cs.cv_gf||0)],
      ['Defence (goals against)', consistencyLabel(cs.cv_ga||0)],
      ['Lineup stability', `${p1(cs.lineup_stability_avg||0)}% same starters game-to-game`],
      ['Big change alerts', `${cs.change_point_count||0} flagged shifts`],
    ];
    document.getElementById('consistencySimple').innerHTML = rows.map(([a,b]) =>
      `<div class="simple-row"><span>${a}</span><strong>${b}</strong></div>`
    ).join('');

    // With/Without ‚Äì top 6, rounded and simplified
    const ww = ((data.squad_impact && data.squad_impact.with_without) || []).slice(0,6);
    document.getElementById('withWithout').innerHTML = ww.map(v => `
      <div class="simple-row">
        <span>üë§ ${v.player_name}</span>
        <span class="small">with ${v.matches_with} / without ${v.matches_without}</span>
        <strong>${v.delta_win_pct>=0?'‚ñ≤':'‚ñº'} Win ${pos(v.delta_win_pct)} ‚Ä¢ Pass ${pos(v.delta_pass_pct)} ‚Ä¢ GF ${pos(v.delta_goals_for_per_game)}/g</strong>
      </div>
    `).join('') || '<div class="small">Not enough data yet.</div>';

    // Best partnerships ‚Äì top 6
    const pairs = ((data.squad_impact && data.squad_impact.top_pairs) || []).slice(0,6);
    document.getElementById('pairs').innerHTML = pairs.map(v => `
      <div class="simple-row">
        <span>ü§ù ${v.pair_name}</span>
        <span class="small">${v.matches_together} games together</span>
        <strong>${p2(v.goal_contrib_per_game)} goals/assists per game</strong>
      </div>
    `).join('') || '<div class="small">Not enough data yet.</div>';
  }

  /* ===== Boot ===== */
  document.addEventListener('DOMContentLoaded', async () => {
    // UI events
    document.getElementById('metricControls').addEventListener('click', e => {
      const box = e.target.closest('.checkbox-item');
      if (box){ e.preventDefault(); box.classList.toggle('active'); if (displayedMatchesData.length) createTrendsChart(displayedMatchesData); }
    });
    document.getElementById('matchCountInput').addEventListener('input', () => { if (allMatchesData.length) updateDisplayedMatches(); });
    document.getElementById('showAllMatches').addEventListener('click', () => {
      document.getElementById('matchCountInput').value = allMatchesData.length;
      if (allMatchesData.length) updateDisplayedMatches();
    });

    // Load match trends
    try{
      const resp = await getJSON('api/matches/all.json');
      const matches = (resp.matches||[]).sort((a,b)=>a.match_timestamp-b.match_timestamp);
      allMatchesData = processMatchData(matches);
      updateDisplayedMatches();
    }catch(err){
      console.error(err);
      document.querySelectorAll('.loading').forEach(el=>el.textContent='Failed to load match data.');
    }

    // Load season overview
    try{
      const s = await getJSON('api/season/summary.json');
      renderSeasonSimple(s);
    }catch(err){
      console.error(err);
      // If missing, the simple tiles just stay empty
    }
  });
})();
</script>
</body>
</html>
